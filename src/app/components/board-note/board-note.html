<section class="section_board">
    <!-- Estado de carga -->
    @if (allNotes.length === 0) {
    <!-- <div class="loading-state">
        <p>Cargando tus notas...</p>
    </div> -->
    <div class="empty-state">
        <p>No tienes notas creadas, crea una ahora y guarda todo lo que necesitas</p>
    </div>
    }

    <!-- Lista de notas -->
    @for (item of (limit ? allNotes.slice(0, limit) : allNotes); track item._id || $index) {
    <div class="nota_miniatura" (click)="onOpenDetail(item)">
        <h3>{{titleNote(item.title)}}</h3>
        <div class="contenido">
            @if (!item.description) {
            <p class="note_description">Tu nota no tiene descripción</p>
            } @else {
            <p>{{descriptionNote(item.description)}}</p>
            }

            <!-- Archivos -->
            <div (click)="toggleVisibilidad(item._id || $index.toString()); $event.stopPropagation()">
                <p class="files_save"><i class="bi bi-folder-fill"></i>{{ (item.urlFile?.length || 0) +
                    (item.urlImage?.length || 0) }} Archivos guardados</p>
            </div>
            @if (isVisible(item._id || '')) {
            <div (click)="$event.stopPropagation()">
                <!-- mostar documentos -->
                @if (item.urlFile && item.urlFile.length > 0) {
                <ul class="list_url">
                    @for (file of (item.urlFile | slice:0:2); track file) {
                    <li><a [href]="baseURL + file" target="_blank">{{getFileName(file)}}</a></li>
                    }
                </ul>
                }
                @if (!item.urlFile || item.urlFile.length === 0) {
                <p class="no_adjunto">No hay archivos adjuntos</p>
                }
                <!-- mostrar imagenes -->
                @if (item.urlImage && item.urlImage.length > 0) {
                <ul class="list_url">
                    @for (image of (item.urlImage | slice:0:2); track image) {
                    <li><a [href]="baseURL + image" target="_blank">{{getFileName(image)}}</a></li>
                    }
                </ul>
                }
                @if (!item.urlImage || item.urlImage.length === 0) {
                <p class="no_adjunto">No hay imagenes adjuntas</p>
                }
                <!-- @if (((item.urlFile?.length||0) + (item.urlImage?.length||0)) > 4) {
                    <p *ngIf="item.urlFile && item.urlFile.length > 4" class="more-files">
                        ... y {{ ((item.urlFile.length||0) + (item.urlImage?.length||0)) - 4 }} archivo(s) más.
                    </p>
                    } -->
            </div>
            }

            <!-- Acciones -->
            <div (click)="$event.stopPropagation()" class="actions">
                <i class="bi bi-trash-fill" (click)="onDeleteNote(item)" title="Eliminar"></i>
                <i class="bi bi-pencil-fill" (click)="updateNote(item)" title="Editar"></i>
                <i class="bi bi-hash" title="Etiquetas"></i>
                <div>
                    <label for="archivo" class="label_files">
                        <i class="bi bi-file-earmark-text-fill" title="Archivos"></i>
                    </label>
                    <input type="file" id="archivo" class="d-none" multiple (change)="onFileSelected($event)">
                </div>
                <div>
                    <label for="imagen" class="label_files">
                        <i class="bi bi-file-image" title="Imágenes"></i>
                    </label>
                    <input type="file" id="imagen" class="d-none" accept="image/*" (change)="onImageSelected($event)">
                </div>
            </div>
        </div>
    </div>
    }
</section>

<!-- Edit Dialog -->
@if (showEditDialog) {
<app-edit-note-dialog [note]="selectedNoteForEdit" (noteUpdated)="handleNoteEdited($event)"
    (closeDialog)="closeEditDialog()" 
    (dataReloaded)="refreshUserDataAndBoards()"></app-edit-note-dialog>
}